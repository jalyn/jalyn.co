{{- define "main" }}
{{- if (and site.Params.profileMode.enabled .IsHome) }}
  {{- partial "index_profile.html" . }}
{{- else }} {{/* if not profileMode */}}
  {{- if not .IsHome | and .Title }}
    <header class="page-header">
      {{- partial "breadcrumbs.html" . }}
      <h1>
        {{- if eq .Kind "term" -}}{{- .Data.Singular }}: {{ end -}}
        {{ .Title -}}
      </h1>
      {{- partial "inline_links.html" . -}}
    </header>
  {{- end }}
  {{- if .Content }}
    <div class="post-content">
      {{- if not (.Param "disableAnchoredHeadings") }}
        {{- partial "anchored_headings.html" .Content -}}
      {{- else }}{{ .Content }}{{ end }}
    </div>
  {{- end }}
  
  {{- $pages := .Pages }}
  {{- if .IsHome }}
    {{/* get all regular pages instead of pages in a section */}}
    {{- $pages = where site.RegularPages "Section" "in" site.Params.mainSections }}
  {{- end }}
  {{- $pages = where $pages "Params.hidden" "!=" true }}
  
  {{/* Get the latest post */}}
  {{- $latestPost := index $pages 0 }}
  
  {{/* Display the latest post as featured */}}
  {{- if $latestPost }}
    <article class="featured-post">
      {{/* <span class="eyebrow">Writing</span> */}}
      <header class="featured-entry">
        <span class="entry-date">{{- .Date.Format "2006-01-02" }}</span>
        <h2>
          <a href="{{ $latestPost.Permalink }}">{{ $latestPost.Title }}</a>
        </h2>
        
        <div class="entry-content">
          {{ $latestPost.Summary }}
        </div>
        <a href="{{ $latestPost.Permalink }}" class="read-more">Read more →</a>
      </header>
    </article>
  {{- end }}


  {{/* Paginate the remaining posts */}}
  {{ $paginator := "" }}
  {{ if (.Param "paginate") }}
    {{- $paginator = .Paginate (after 1 $pages) (.Param "paginate") }}
  {{ else }}
    {{- $paginator = .Paginate (after 1 $pages) }}
  {{ end }}
  
  {{- if and .IsHome site.Params.homeInfoParams (eq $paginator.PageNumber 1) }}
    {{- partial "home_info.html" . }}
  {{- end }}
  
  {{- $term := .Data.Term }}
  {{- range $index, $page := $paginator.Pages }}
    {{- $class := "post-entry" }}
    {{- $user_preferred := or site.Params.disableSpecial1stPost site.Params.homeInfoParams }}
    {{- if (and $.IsHome (eq $paginator.PageNumber 1) (eq $index 0) (not $user_preferred)) }}
      {{- $class = "first-entry" }}
    {{- else if $term }}
      {{- $class = "post-entry tag-entry" }}
    {{- end }}
    <article class="{{ $class }}">
      <header class="entry-header">
        
        <div class="entry-info">
          <span class="entry-date">{{- .Date.Format "2006-01-02" }}</span>
          <h2 class="entry-title">
            <a href="{{ .Permalink }}"><span class="title-text">{{ .Title }}</span></a>
          </h2>
        </div>
      </header>
    </article>
  {{- end }}
  
  {{- if gt $paginator.TotalPages 1 }}
    <footer class="page-footer">
      <nav class="pagination">
        {{- if $paginator.HasPrev }}
          <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">« {{ i18n "prev_page" }}</a>
        {{- end }}
        {{- if $paginator.HasNext }}
          <a class="next" href="{{ $paginator.Next.URL | absURL }}">{{ i18n "next_page" }} »</a>
        {{- end }}
      </nav>
    </footer>
  {{- end }}
  
 {{- end }}{{/* end profileMode */}}
 
{{- end }}{{- /* end main */ -}}